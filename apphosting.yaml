# Settings to manage and configure a Firebase App Hosting backend.
# https://firebase.google.com/docs/app-hosting/configure

# Specifies the node version to use.
runtime: nodejs20

# This specifies that this backend needs access to Cloud SQL.
cloudsql:
  # The instance connection name can be found on the Cloud SQL instance overview page.
  instances:
    - fastbasket:europe-west10:delivery

# Non-secret environment variables.
# These values are available during both build and runtime.
environmentVariables:
  LOG_LEVEL: debug
  LOG_FORMAT: text
  NEXT_PUBLIC_S3_PUBLIC_URL: https://storage.googleapis.com/fastbasket-images
  # App Hosting sets K_SERVICE automatically, but we define it for clarity.
  K_SERVICE: 'fastbasket'
  # This crucial variable is also set automatically by App Hosting.
  # We reference it in our db.ts to ensure the correct connection string.
  CLOUD_SQL_CONNECTION_NAME: 'fastbasket:europe-west10:delivery'
  # --- TEMPORARY DIAGNOSTIC STEP ---
  # Replace these with your actual credentials to test the connection.
  PG_USER: "YOUR_PG_USER"
  PG_PASSWORD: "YOUR_PG_PASSWORD"
  PG_DATABASE: "YOUR_PG_DATABASE"
  S3_BUCKET_NAME: "fastbasket-images"
  S3_ENDPOINT_URL: "https://storage.googleapis.com"
  S3_REGION: "europe-west10"
  S3_ACCESS_KEY_ID: "YOUR_S3_ACCESS_KEY_ID"
  S3_SECRET_ACCESS_KEY: "YOUR_S3_SECRET_ACCESS_KEY"

# Use secret environment variables to securely pass credentials to the application.
# The 'key' is the environment variable name available to the app.
# The 'secret' is the name of the secret in Google Secret Manager.
# --- TEMPORARILY DISABLED FOR DIAGNOSTICS ---
# secretEnvironmentVariables:
#   - key: PG_USER
#     secret: PG_USER
#   - key: PG_PASSWORD
#     secret: PG_PASSWORD
#   - key: PG_DATABASE
#     secret: PG_DATABASE
#   - key: S3_BUCKET_NAME
#     secret: S3_BUCKET_NAME
#   - key: S3_ENDPOINT_URL
#     secret: S3_ENDPOINT_URL
#   - key: S3_REGION
#     secret: S3_REGION
#   - key: S3_ACCESS_KEY_ID
#     secret: S3_ACCESS_KEY_ID
#   - key: S3_SECRET_ACCESS_KEY
#     secret: S3_SECRET_ACCESS_KEY
