## 1. Технологии

- **Фреймворк:** Next.js (App Router)
- **Язык:** TypeScript
- **UI-библиотека:** React, ShadCN UI
- **Стилизация:** Tailwind CSS
- **База данных:** PostgreSQL (через Google Cloud SQL)
- **Хранилище файлов:** Google Cloud Storage (S3-совместимый API)
- **AI/LLM:** Google Genkit
- **Деплоймент:** Firebase App Hosting

## 2. Архитектура проекта

Проект строится на основе классической **трехслойной архитектуры**, адаптированной под Next.js App Router:

1.  **Слой представления (UI Layer):**
    -   Находится в `src/app` (страницы и компоненты) и `src/components`.
    -   Отвечает исключительно за отображение данных и взаимодействие с пользователем.
    -   Компоненты не содержат прямой бизнес-логики или запросов к базе данных. Они вызывают `Server Actions`.

2.  **Слой действий и сервисов (Actions & Services Layer):**
    -   Находится в `src/app/actions` и `src/lib/services`.
    -   `Actions` служат точкой входа для UI. Они валидируют данные и вызывают соответствующие сервисы.
    -   `Services` (например, `products.service.ts`) инкапсулируют бизнес-логику и являются единственным местом, где происходит работа с данными (CRUD). Это гарантирует, что UI отделен от деталей реализации хранилища.

3.  **Слой доступа к данным (Data Access Layer):**
    -   Представлен модулем `src/lib/db.ts` и `src/lib/s3-client.ts`.
    -   Обеспечивает низкоуровневое подключение и взаимодействие с PostgreSQL и S3.
    -   Сервисный слой использует этот модуль, полностью абстрагируясь от деталей подключения (будь то Cloud SQL Proxy или Unix-сокет в продакшене).

## 3. Модель данных и Роли

### 3.1. Основные сущности (Таблицы БД)

Модель данных спроектирована в реляционной парадигме и хранится в PostgreSQL. Ключевые сущности включают:

-   **Users:** Пользователи системы (клиенты, администраторы).
-   **Roles:** Роли пользователей (`admin`, `customer`).
-   **UserRoles:** Связующая таблица для назначения ролей.
-   **Products:** Каталог товаров со всеми характеристиками (цена, описание, SKU).
-   **Categories:** Иерархические категории товаров с префиксами для SKU.
-   **Orders:** Информация о заказах клиентов.
-   **OrderItems:** Позиции товаров внутри каждого заказа.
-   **Media:** Метаданные о файлах, загруженных в S3 (например, изображения товаров).

*Подробная схема находится в `docs/S3_SQL_instruction.md`.*

### 3.2. Ролевая модель (Права доступа)

Система будет поддерживать следующие роли с четким разделением прав:

1.  **Гость (неавторизованный пользователь):**
    -   Может: просматривать каталог, товары, категории; добавлять товары в корзину (корзина хранится на клиенте).
    -   Не может: оформлять заказ, просматривать историю заказов, заходить в админ-панель.

2.  **Клиент (Customer, авторизованный пользователь):**
    -   Может: всё, что может Гость, плюс оформлять заказы, просматривать свою историю заказов, управлять своим профилем.
    -   Не может: заходить в админ-панель.

3.  **Администратор (Admin):**
    -   Может: всё, что может Клиент, плюс полный доступ к админ-панели (`/admin`) для управления товарами, категориями, заказами и просмотра системных логов.

*На текущем этапе аутентификация и разделение ролей не реализованы. Все пользователи фактически имеют права Гостя. Админ-панель открыта для доступа без авторизации. Это будет исправлено на следующих этапах разработки.*
