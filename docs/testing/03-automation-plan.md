# ⚙️ План автоматизации тестирования

Этот документ описывает технические аспекты автоматизации тестирования: инструменты, структуру и приоритеты.

## 1. Инструменты

-   **Unit и Integration тесты:** [Vitest](https://vitest.dev/) — современный, быстрый и совместимый с Jest фреймворк для тестирования.
-   **E2E тесты:** [Playwright](https://playwright.dev/) — мощный инструмент от Microsoft для End-to-End тестирования в реальных браузерах.
-   **CI/CD:** [GitHub Actions](https://github.com/features/actions) — для автоматического запуска тестов при каждом коммите и Pull Request.

## 2. Структура папки `tests/`

Для организации тестов мы будем использовать следующую структуру в корне проекта:

```
tests/
├── unit/
│   ├── services/           # Тесты для бизнес-логики (products.service.test.ts)
│   ├── utils/              # Тесты для вспомогательных функций
│   └── validation/         # Тесты для схем Zod
│
├── integration/
│   ├── actions/            # Тесты для Server Actions (проверка взаимодействия с сервисами)
│   └── db/                 # Тесты, проверяющие сложные SQL-запросы (опционально)
│
├── e2e/
│   ├── smoke/              # Быстрые тесты на самый критичный функционал
│   └── regression/         # Полные регрессионные сценарии
│
└── fixtures/               # Моковые данные, JSON-фикстуры для тестов
```

## 3. Приоритеты автоматизации (MVP)

Мы начнем с автоматизации тестов, которые покрывают наиболее критичные и уже вызвавшие проблемы участки кода.

### Unit-тесты (Первый приоритет)
1.  **Валидация схем Zod:**
    -   `templateFormSchema`: Проверить, что правило `step_quantity <= min_order_quantity` работает корректно. (Воспроизводит найденный баг).
    -   `productFormSchema`: Проверить логику для `is_weighted`.
2.  **Утилиты:**
    -   `orders.utils.ts`: Проверить функции `validateOrderStatus` и `isFinalStatus`.

### Integration-тесты (Второй приоритет)
1.  **`createProductAction`:**
    -   Написать тест, который проверяет, что при создании весового товара с шаблоном значения из шаблона корректно копируются ("snapshot" подход).
2.  **`updateOrderStatusAction`:**
    -   Проверить, что статус заказа успешно обновляется и что нельзя изменить финальный статус (`Выполнен`, `Отменен`).

### E2E-тесты (Третий приоритет)
1.  **Smoke-тест "Оформление заказа":**
    -   Открыть главную страницу -> перейти в каталог -> добавить товар в корзину -> открыть корзину -> нажать "Оформить заказ" -> убедиться, что заказ появился в админ-панели.