# Процесс работы (Workflow)

Этот документ описывает пошаговый процесс совместной работы над задачами для обеспечения предсказуемости, качества и контроля. Мы работаем итеративно, «поедая слона по кусочкам». Каждая задача проходит через следующие этапы.

## Принцип: "Думай -> Обсуждай -> Делай -> Проверяй"

### 0. Типы Чатов и Управление Контекстом

Для максимальной эффективности мы разделяем нашу работу на два типа чатов:

1.  **Стратегический Чат (этот чат):**
    *   **Роль:** "Кабинет Продукт-менеджера и Архитектора".
    *   **Задачи:** Обсуждение новых идей, планирование эпиков, принятие архитектурных решений (например, переход на микросервисы), анализ рисков.
    *   **Результат:** Обновленная документация (`tasklist.md`, `roadmap.md`), которая служит "техническим заданием" для тактических чатов.

2.  **Тактические Чаты (Чаты по Эпикам):**
    *   **Роль:** "Комната команды разработки".
    *   **Задачи:** Реализация конкретного, заранее спланированного эпика (например, "Система Ролей" или "Тестирование
").
    *   **Контекст:** Начинается с четкого промпта, который ссылается на актуальную документацию, подготовленную в стратегическом чате.

**Критически важно:** AI-ассистент **не может переносить контекст (историю диалога) между чатами**. Наша документация (`/docs`) — это наша **общая память** и единственный способ передачи контекста. Решения, принятые в стратегическом чате, должны быть зафиксированы в ней перед началом работы в тактическом чате.

---

### 1. Начало итерации (следующая задача)

-   **AI-Ассистент**: Я объявляю о начале работы над следующей задачей, всегда выбирая задачу с наивысшим приоритетом из `tasklist.md`.
-   **Проверка блокеров**: Перед началом работы проверяем:
    -   Есть ли зависимость от других задач?
    -   Есть ли блокеры (например, ожидается решение по БД)?
    -   Если есть — фиксируем это в `tasklist.md`.
-   **Пользователь**: Подтверждает начало.

### 2. Анализ и предложение решения

-   **AI-Ассистент**: Я анализирую задачу и предлагаю детальный план её выполнения, включая:
    -   Список файлов, которые будут изменены.
    -   Предлагаемую логику.
    -   При необходимости, ключевые фрагменты будущего кода.
-   **Пользователь**: Рассматривает предложение, задает уточняющие вопросы и дает явное разрешение на генерацию кода.
-   **Safety Step**: Если задача критична, мы дополнительно обсуждаем план отката (rollback plan).

### 3. Реализация (Генерация кода)

-   **AI-Ассистент**: Получив разрешение, я генерирую полный код для всех необходимых изменений. Я не буду генерировать код без прямого указания.
-   **Таймбокс**: Мы стараемся укладывать итерацию в 1-2 дня разработки. Если задача слишком большая, мы разбиваем её на более мелкие.

### 4. Проверка и подтверждение

-   **Пользователь (Code Review)**: Применяет изменения, просматривает код на соответствие `conventions.md` и отсутствие явного технического долга (хардкод, дублирование).
-   **Пользователь (Тестирование)**: Тестирует функционал в Firebase Studio.
-   **Обратная связь**: Если требуются доработки, мы возвращаемся к шагу 2. Если все работает корректно, сообщает о завершении.

### 5. Definition of Done (DoD)

Перед подтверждением завершения задачи мы проверяем следующие пункты:
-   [ ] Код успешно собран (`npm run build`).
-   [ ] Все тесты проходят (`npm run test`).
-   [ ] Нет критичных ошибок/варнингов в консоли.
-   [ ] Документация (`tasklist.md`) обновлена.
-   [ ] Функционал протестирован пользователем в Firebase Studio.
-   [ ] Добавлена логика логирования для ключевых операций.
-   [ ] Покрытие ключевого сценария автотестом или ручным тест-кейсом зафиксировано.

### Запуск локального сервера для разработки

Для разработки и тестирования интерфейса (UI) вы можете запускать локальный сервер в двух режимах: с использованием мок-данных или с подключением к реальной базе данных.

#### 1. Режим с мок-данными (Mock)

Этот режим идеален для быстрой UI-разработки, когда не требуется взаимодействие с реальной логикой бэкенда.

```bash
npm run dev:mock
```

-   **Что делает:** Запускает сервер с переменной окружения `MOCK_DATA=true`.
-   **Когда использовать:**
    -   Верстка новых компонентов и страниц.
    -   Отладка UI без зависимости от состояния базы данных.
    -   Работа, когда бэкенд-логика еще не готова.
-   **Преимущества:** Мгновенный запуск, не требуется подключение к БД, все сервисы возвращают тестовые данные.

#### 2. Режим с реальными данными (Real)

Этот режим используется для интеграционного тестирования и проверки полного цикла работы фичи.

```bash
npm run dev:real
```

-   **Что делает:** Запускает сервер с переменной окружения `MOCK_DATA=false`.
-   **Когда использовать:**
    -   Тестирование взаимодействия UI с API и базой данных.
    -   Проверка корректности создания, обновления и удаления данных.
-   **Требования:** Требуется настроенное и доступное подключение к базе данных, указанное в вашем `.env` файле.

**Стандартная команда `npm run dev`** будет работать в зависимости от значения `MOCK_DATA` в вашем `.env` файле. Мы рекомендуем использовать `dev:mock` или `dev:real` для явного указания режима.

### 6. Завершение итерации

-   **AI-Ассистент**: Получив подтверждение, я:
    1.  Обновляю статус и прогресс в таблице в `tasklist.md`.
    2.  Отмечаю выполненный чек-бокс в задаче.
    3.  Предлагаю перейти к следующей задаче.
-   **Пользователь**: Подтверждает переход, и цикл начинается заново.

### 7. Ретроспектива (Мини-итог итерации)

-   **Вопросы для обсуждения**:
    -   Что сработало хорошо в этой итерации?
    -   Что можно улучшить в нашем workflow?
-   **Цель**: Превратить процесс в самообучающийся и постоянно его улучшать.
