# Технический блюпринт: Система логирования

Этот документ описывает финальную, реализованную архитектуру системы логирования в приложении.

## 1. Ключевые цели

- **Безопасность**: Обеспечить, чтобы клиентский код не имел доступа к серверным модулям (таким как `fs`).
- **Информативность**: Собирать подробные логи как на клиенте, так и на сервере для быстрой отладки.
- **Управляемость**: Предоставить администратору удобный интерфейс для просмотра и управления логами.

## 2. Реализованная архитектура

Система разделена на два независимых модуля для обеспечения безопасности и изоляции окружений.

### 2.1. Универсальный логгер (Client & Server Safe)

- **Расположение**: `src/lib/logger.ts`
- **Назначение**: Используется в любом компоненте или файле, который может выполняться на клиенте (React-компоненты, хуки, контексты).
- **Функционал**:
    - Выводит логи только в **консоль** (браузера или сервера).
    - Не имеет зависимостей от Node.js API (`fs`, `path`).
    - Поддерживает уровни: `debug`, `info`, `warn`, `error`.
    - Поддерживает категории (`logger.withCategory('CATEGORY')`).
    - Поддерживает замеры производительности (`time`, `timeEnd`).

### 2.2. Серверный логгер (Server-Only)

- **Расположение**: `src/lib/server-logger.ts`
- **Назначение**: Используется **строго** в коде, который гарантированно выполняется только на сервере (Server Actions, Route Handlers, код в `lib/firebase-admin.ts`).
- **Функционал**:
    - Дублирует все возможности универсального логгера.
    - Дополнительно записывает каждый лог в файл `public/debug.log`.
    - Использует Node.js API (`fs`, `path`) для работы с файловой системой.
    - Может форматировать вывод в текст или JSON (настраивается через `LOG_FORMAT` в `.env`).

### 2.3. Серверные действия для управления логами

- **Расположение**: `src/lib/actions/log.actions.ts`
- **Назначение**: Предоставляют API для взаимодействия с файлом логов из админ-панели.
- **Экшены**:
    - `getLogsAction()`: Читает содержимое и размер файла `debug.log`.
    - `clearLogsAction()`: Полностью очищает файл `debug.log`.

### 2.4. Интерфейс администратора

- **Расположение**: `src/app/admin/logs/page.tsx`
- **Назначение**: UI для управления логами.
- **Функционал**:
    - Отображение логов из `debug.log`.
    - Обновление, очистка (с подтверждением), фильтрация.
    - Отображение размера файла.
    - Опция автоматической очистки при превышении лимита в 5 МБ.

## 3. Правила использования

1.  **В клиентском коде** (любой `.tsx` или `.ts` файл в `src/components`, `src/app`, `src/hooks`, `src/contexts`):
    ```typescript
    import { logger } from '@/lib/logger';
    const componentLogger = logger.withCategory('MY_COMPONENT');
    ```

2.  **В серверном коде** (`src/app/actions`, `src/lib/firebase-admin.ts`):
    ```typescript
    import { serverLogger } from '@/lib/server-logger';
    const actionLogger = serverLogger.withCategory('MY_ACTION');
    ```

---
**Заключение:** Текущая реализация полностью соответствует поставленным целям, является безопасной и эффективной, обеспечивая четкое разделение между клиентской и серверной логикой логирования.