# Введение в проект "БыстраяКорзина"

Этот документ — точка входа для нового разработчика. Он дает краткий, но исчерпывающий обзор проекта, его архитектуры и ключевых принципов.

## 1. Концепция

"БыстраяКорзина" — это современное e-commerce приложение для доставки продуктов, построенное на стеке Next.js. Ключевые особенности:
- **Server-First подход**: Максимум логики выполняется на сервере для высокой производительности.
- **Модульность**: Четкое разделение на слои для простоты поддержки и масштабирования.
- **Готовность к AI**: Архитектура спроектирована для легкой интеграции с генеративными моделями через Genkit.

**Ключевой документ для ознакомления:**
- `docs/vision.md`: Полное техническое и продуктовое видение проекта.

## 2. Технологический стек

- **Фреймворк**: Next.js (App Router)
- **Язык**: TypeScript
- **UI**: React, ShadCN UI, Tailwind CSS
- **База данных**: PostgreSQL (подключается через Cloud SQL)
- **Хранилище**: Google Cloud Storage (S3-совместимый API)
- **AI**: Google Genkit

## 3. Архитектура

Проект следует классической **трехслойной архитектуре**:

1.  **Слой Представления (UI)**
    - **Где**: `src/app/**`, `src/components/**`
    - **Описание**: React-компоненты (преимущественно серверные), которые отвечают только за отображение. Они не содержат бизнес-логики.

2.  **Слой Действий и Сервисов (Business Logic)**
    - **Где**: `src/app/actions/**`, `src/lib/services/**`
    - **Описание**:
        - `Server Actions` служат точкой входа для UI. Они получают данные из форм, валидируют их и вызывают сервисы.
        - `Services` (например, `products.service.ts`) инкапсулируют всю бизнес-логику (CRUD, взаимодействие с БД). **Это единственное место, где есть прямые запросы к базе данных.**

3.  **Слой Доступа к Данным (Data Access)**
    - **Где**: `src/lib/db.ts`, `src/lib/s3-client.ts`
    - **Описание**: Низкоуровневые модули, которые управляют подключением к PostgreSQL и S3.

```mermaid
graph TD
    A[UI Layer (React Components)] -->|Вызывает| B(Server Actions);
    B -->|Вызывает| C{Service Layer (products.service.ts)};
    C -->|Использует| D[Data Access Layer (db.ts)];
    D -->|Подключается к| E((PostgreSQL));
```

## 4. Как запустить локально

Проект спроектирован для работы в **Firebase Studio**. Для корректной работы с данными вне продакшн-окружения реализован специальный механизм.

**Ключевой принцип:**
В сервисах (`/lib/services/*.ts`) есть проверка переменной окружения `process.env.K_SERVICE`.
- Если ее **нет** (мы в Studio), сервисы возвращают **моковые данные** из `src/lib/mock-data.ts`.
- Если она **есть** (мы в продакшене), сервисы делают реальные запросы к Cloud SQL.

Это позволяет разрабатывать и отлаживать UI без необходимости прямого подключения к боевой базе данных.

**Пример из `products.service.ts`:**
```typescript
const isLocal = !process.env.K_SERVICE;

export async function getProducts(filters?: ProductFilter): Promise<Product[]> {
    if (isLocal) {
        productsServiceLogger.warn("Running in local/studio environment. Returning mock products.");
        return [mockProduct]; // Возвращаем тестовые данные
    }
    // ... логика для реального запроса к БД
}
```

## 5. Важные файлы для ознакомления

- `docs/vision.md`: Главный архитектурный документ.
- `docs/conventions.md`: Правила написания кода.
- `docs/tasklist.md`: Актуальный план работ.
- `docs/workflow.md`: Как мы работаем над задачами.
- `docs/S3_SQL_instruction.md`: SQL-схема базы данных.
- `apphosting.yaml`: Конфигурация деплоймента для Firebase App Hosting.